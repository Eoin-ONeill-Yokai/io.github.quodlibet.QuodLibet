---
app-id: io.github.quodlibet.QuodLibet
runtime: org.gnome.Platform
runtime-version: '3.28'
sdk: org.gnome.Sdk
command: quodlibet
build-options:
  no-debuginfo: true
  strip: true
finish-args:
  - "--share=network"
  - "--socket=x11"
  - "--share=ipc"
  - "--socket=wayland"
  - "--socket=pulseaudio"
  - "--filesystem=host"

  # some embedded covers and the fifo is still shared through /tmp
  - "--filesystem=/tmp"

  # bookmarks in the filesystem browser
  - "--filesystem=xdg-config/gtk-3.0:ro"

  # Various D-Bus names: for...
  # ...multimedia keys
  - "--talk-name=org.gnome.SettingsDaemon"
  - "--talk-name=org.gnome.SettingsDaemon.MediaKeys"
  - "--talk-name=org.mate.SettingsDaemon"

  # ...detecting the running desktop environment
  - "--talk-name=com.canonical.Unity.Launcher"
  - "--talk-name=org.enlightenment.wm.service"
  - "--talk-name=org.kde.plasmashell"

  # ...MPRIS support
  - "--own-name=org.mpris.quodlibet"
  - "--own-name=org.mpris.MediaPlayer2.quodlibet"

  # ...various other plugins
  - "--own-name=org.gnome.UPnP.MediaServer2.QuodLibet"
  - "--talk-name=org.freedesktop.Avahi"
  - "--talk-name=org.freedesktop.FileManager1"
  - "--talk-name=org.freedesktop.Notifications"
  - "--talk-name=org.freedesktop.Telepathy.AccountManager"
  - "--talk-name=org.gajim.dbus"
  - "--talk-name=org.gnome.ScreenSaver"
  - "--talk-name=org.gnome.SessionManager"
  - "--talk-name=org.kde.StatusNotifierWatcher"
  - "--talk-name=org.xfce.FileManager"

  # ...talking to dconf
  - "--filesystem=xdg-run/dconf"
  - "--filesystem=~/.config/dconf:ro"
  - "--talk-name=ca.desrt.dconf"
  - "--env=DCONF_USER_CONFIG_DIR=.config/dconf"

modules:
  - python-modules.json
  - kakasi.yaml
  - flathub-shared-modules/libappindicator/libappindicator-gtk3-introspection-12.10.json
  - name: gst-libav
    config-opts:
      - "--disable-gtk-doc"
    cleanup:
      - "*.la"
      - "/share/gtk-doc"
    sources:
      - type: archive
        url: https://gstreamer.freedesktop.org/src/gst-libav/gst-libav-1.14.0.tar.xz
        sha256: fb134b4d3e054746ef8b922ff157b0c7903d1fdd910708a45add66954da7ef89
  - name: gst-plugins-ugly
    config-opts:
      - "--disable-gtk-doc"
    cleanup:
      - "*.la"
      - "/share/gtk-doc"
    sources:
      - type: archive
        url: https://gstreamer.freedesktop.org/src/gst-plugins-ugly/gst-plugins-ugly-1.14.0.tar.xz
        sha256: 3fb9ea5fc8a2de4b3eaec4128d71c6a2d81dd19befe1cd87cb833b98bcb542d1
  - name: quodlibet
    buildsystem: simple
    subdir: quodlibet
    build-commands:
      - pip3 install --no-deps --prefix=${FLATPAK_DEST} .
    sources:
      - type: git
        url: https://github.com/quodlibet/quodlibet.git
        # branch: quodlibet-4.1
        commit: 624b514c648b202b8132cdce2c575580361577a5
